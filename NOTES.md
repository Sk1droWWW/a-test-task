# Notes

В этом файле неформально описаны мысли, которые будут появлятся у меня походу выполненения тестового, апдейтить все буду комитами, под тегом "docs", более официальную и стандартизированую инфу можно будет увидеть в гит-истории, а так же в README.md.  

### День 0. Вечер Среды

Изначальные заметки к планированию апки:
- Single Activity;
- NavigationComponent + SafeArgs;
- MVVM(По одному фрагменту + viewModel для каждого экрана, репозиторий для единого интерфейса доступа к model, model -- Room для доступа к сохранненым персонажем, Retrofit для запросов, вся асинхрощина - с помощью корутин);

Подводные камни, про которые сразу подумал:
- Для smooth ux поиска нужно будет использовать пагинацию;
- Возможно у апи есть какие-то ограничения на количество запросов в минуту, от этого возможно придется плясать;
- Пока-что не совсем понимаю, что именно нужно отображать в ошибках, но по ходу дела скорее всего разберусь);
- Картинки до этого не кешировал, но поскольку это доп. таска, то оставлю это на конец;

Что сделаю дополнительного если буду успевать быстрее дедлайна:
- Добавлю какой-то фрейморк с Dependency Injection;
- Попробую разбить приложения на модули в соответствии с Clean Architecture;
- Поработаю с анимациями, самими интерфейсом и пользовательским опытом;
- Мигрирую с LiveData на Kotlin Flow.
- Разберусь с ненужными lateinit

Ближайший план действий:
1. Навскидку подключить все неободимые библиотеки.
2. Наметить структуру проекта пофайлово.
3. Cверстать минимально-рабочий интерфейс.

P.S. С картиночками буду работать с помощью Coil, когда до этого дойдет

### День 1

С вчерашних планов: подключил либы, потихоньку накидываю структуру проекта. Поставил поддержку только портретного режима, чтобы не мучаться с UI в landscape

Для обращения к интерфейсу, буду использовать viewBinding. Саму binding буду инииализировать через lateinit в onCreate(знаю, что это не лучшая практика, но пока-что не знаю как сделать лучше)

Перед тем как сделал bottomnavview случайно обновил студию, из-за чего слетел adb и я промучился 2 часа с тем, чтобы попытаться запустить апку на девайсе)

Потихоньку делаю верстку, походу дела, понял что не совсем понимаю, как хендлить клик на вьюху в елементе списка и отдельно на саму вьюху)

Cейчас стараюсь сделать минимально работающую апку без работы с сетью, для того, чтобы сделать UI более приятным

Итоги дня: 
1. В апке сверстан минимально рабочий интерфейс(к тому же не вырвиглазный).
2. Сделана навигация и струтктура проекта.
3. Все фрагменты и бд готовы к реализации фич.

Планы на завтра:
1. Допилить UI
2. Сделать логику удаления/добавления персонажа в "любимые".
3. Реализовать Репозиторий
4. Отладить поиск имен.

### День 2

Стараюсь доделать отображение и визуальное взаимодействие с добавление/удалением кокнретного персонажа с всех трёх экранов. Как доделаю, перейду к стилям и сделай рефакторинг в xml-файлах.

Cейчас буду делать репозиторий и работу с сетью. Для начала попробую какой-то запрос с фиксированым количеством ответом, потом добавлю пагинацию. После чего буду допиливать уже остальные фичи приложения.

Конкретно эта часть самая сложная во всем тестовом, потому-что нужно грамотно продумать выгрузку и доступ к данным как и с экрана поиска, так и с экрана любимых персонажей. При этом я хочу на экране поиска отображать есть ли какой-то обьект в любимых, что создает дополнительные сложности. Плюс, теперь кажется начинаю понимать что имелось ввиду под отображением ошибок, как минимум надо будет завести услоный Enum для отображения состояний сети и прогресс бар для длительной подгрузки.

Такс, понял, что для в предыдущем абзаце слишком много детелей, поэтому попробую его реализовать по пунктам:
1. Сделать Retrofit-сервис для получения фиксированого количества айтемов с хардкод-именем.
2. Сделать OnQueryTextListener в search view и не хардкод-имя.
3. Добавить прогресс бар, пагинацию и мб ошибки.
4. Вот тут на этом пункте и подойду к заветному репозиторию.

### День 3

Заметка поздняя, ибо в общаге выключили свет и пришлось прождать пару часов, чтобы начать что-то делать, но не суть)
Сейчас занимаюсь потихоньку первыми тремя пунктами с вчерашних тасков. Разобрался с самим SWApi и тем какие мне запросы нужны, так что попробую сразу поиск вместе с пагинацией.

### День 4

Вчера вечером словил странную ошибку с Moshi, сегодня тоже получил подобную, в итоге пришлось потраить почти 4 часа на то, чтобы понять, что кое-кто ошибся в BaseUrl для подключения апи)

Ура, наконец-то получилось реализовать пагинацию так как я хотел. Для этого правда пришлось перейти с livedata на Flow(возможно временно, пока не разберусь что делал не так с livedata). В ближайшее время тогда сделаю отображение ошибок сети, а дальше уже можно допиливать функционал.
Самой сложной задачей, пока-что считаю отображение любимых персонажей на экране поиска

По планам:
1. Реализовать сохранение и удаление данных через Details екран
2. Отображение сохранненых через Details экран на экране с любимыми персонажами + удаление их через этот экран.
3. Корректно отоброжать список фильмов в которых появлялся персонаж.
4. Отображение любимых персонажей на экране поиска + их добавление/удаление там же

Только что принял оч важное решение. Начинаю делать так, чтобы репозиторий из вне работал(возвращал/брал) только domain сущности, а внутри уже разбирался нужна ему Network сущность или DB

### День 5

Продолжаю работать с вчерашними планами. В голову пришла отличная идея того как можно реализовать прогресс бар загрузки + отображение ошибок сети, но для этого придется подключить DataBinding.
Думаю, сегодня окончательно смогу закончить весь функционал апки, а дальше просто надо будет отрефакторить и красивенько оформить)

Такс, с ошибки сети как оказалось можно более красиво хендлить -- через LoadStateAdapter, правда с ним тоже проблемы и как их решить я не знаю..

В ближайшие пару часов займусь реализацией корректного отображения с детальной инфы про персонажа и взаимодействием с кнопками удаления/добавления со всех экранов

Сейчас получилось немного костыльно реализовать добавление/удаления персонажа в любимые без учета того, что на экране с поиском уже могут отображаться любимые персонажи.

Такс, наконец-то сделал добавление/удаление с учетом экрана поиска. Решение оказалось довольно интересным. Поскольку ViewModel и View работают полностью с доменной моделью от репозитория, то я решил завести в доменной модели поле, которое отображает сохраненный айтем или нет. По умолчанию, когда получаю данные с бд мапер преобразовует стейт этой переменной в положительный. А для того, чтобы преобразовать его в положительный на данных из сети, в мапере сделал дополнительную проверку на существование айтема в бд. Таким образом к viewModel поступают сущности, в которых уже есть вся нужная информацая, все что осталось - правильно их обработать)
Из минусов, я понял что для той переменной нужно было завести Enum, который хранит стейты, а не булевую переменную, но это пофиксится завтра)

Итого, планы на завтра:
1. Реализовать отображение списка фильмов.
2. Пофиксить пару багов в отображении любимых на экране поиска.
3. Все таки завести Enum вместо будевой переменной.
4. Поправить UI(как верстку, так и сами стили).
5. Отрефакторить(про это подробнее уже завтра)

(Дополнительно)
6. Пофиксить LoadStateAdapter

### День 6

Для работы с фильмами, надо будет немного апгрейднуть бд и реализовать many to many отношения между фильмами+персонажами.

В одну сторону отображение фильмов я сделал(с сети в список экранов, а оттуда в детальную инфу про персонажа), осталось правильно заносить их в бд, для отображения на списке. Правда теперь загрузка стала оч долгой, что не мудрено, ибо теперь для каждого персонажа в списке идет запрос на поиск фильмов. Скорее всего эту логику следует оттуда вынести, а в details экране через репозиторий брать фильмы(или из сети, или из бд, что будет решать репозиторий), но пока-что времени на это нету(. Ну а еще, сейчас понял что было бы хорошо работу маперов вынести с главного потока в корутины.

Оптимизировал, оптимизировал, да наоптимизировал... Пробую сейчас реализовать идею, которую описал выше, с тем, чтобы брать список фильмов с сети/бд уже в details фрагменте. При запросе с сети все гуд, а вот если это с бд, то тут какой-то цирк, я уже час не могу понять что делаю не так и почему у меня не отображается список фильмов. Самое забавное, что ошибок мне не выдает, но и к return-у, который должен возвращать список фильмов дебагер у меня просто не доходит. Это последнее что я сделаю по функционалу, дальше только Readme и тестовое готово)

Такс, ошибка оказалась была из-за того, что я не правильно обрабатывал респонс с бд, решил бы намного быстрее, но уже и вправду устал

### ИТОГО

Горд собой за то, что смог дойти до адекватного разделения сущностей вышло достаточно изящное(точно не идеальное) решение. 

Из минусов:
- так и не разобрался в том, что не так с stateAdapter-ом;
- в качестве репозитория возможно можно было использовать PagingSource класс;
- не добавлены фотки;
- recycler на экране любимых после удаления элемента обновляется весь;
- на экране с поиском сердечки не всегда корректно отображают то есть ли персонаж в любимых или нет;
- для подгрузки абсолютно всего можно было бы добавить всюду progress bar-ы.
- сам код, много где можно было бы отрефакторить(одни маперы чего стоят).
- так и не добавил анимации.

Из плюсов:
- в тестовом правда были интересные задачи;
- узнал про stateAdapter;
- поработал с отношениями в бд;
- попробовал бы дальше реализовать весь функционал или сделать полноценный пет проект aka starwars-wiki)